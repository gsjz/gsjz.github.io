Local Area Network，缩写 LAN。


## 局域网拓扑实现

常见的四类：星形，环形，总线，星形和总线形。

- 以太网，目前使用范围最广，逻辑拓扑是总线形，物理拓扑是星形。

- 令牌环 Token Ring, IEEE 802.5，逻辑拓扑是环形，物理拓扑是星形。

- FDDI，光纤分布数字接口，IEEE 802.8，逻辑拓扑是环形，物理拓扑是双环。

## IEEE 802 协议层

OSI 参考模型，就是那七个 XX 层。

IEEE 802，只对应了 OSI 最底下两个：数据链路层 和 物理层。

其中 数据链路层 被细分为 LLC（逻辑链路控制）和 MAC（介质访问控制）。

LLC 实际上是一套软件的东西。

MAC 要通过网卡硬件实现。但网卡还包括了物理层中与 MAC 层的接口。

所以说网卡主要工作在数据链路层，同时也涉及物理层。


## MAC 子层

自同步：每个比特中间必然有一次电平跳变，因此接收端容易提取时钟。


介质访问控制（MAC）子层的主要功能：控制和协调所有站点对共享介质的访问。

??? question "为什么说 MAC 子层并不实现数据链路层和物理层之间的接口？"

    MAC 子层本身不负责把帧变成电信号，也不负责把电信号恢复为比特流。

    它只负责数据链路层内部的帧级控制，不直接触碰物理介质。

    真正和物理层对接的部分是 MAC 与物理层之间的接口（通常叫 MAC-PHY 接口，例如 MII/GMII/XGMII 等）。


## 曼彻斯特编码

曼彻斯特编码是一种 物理层上的信号编码方式，用于把数字比特流（0/1）转换成电信号，方便在物理介质上传输。

它在 每个比特周期中间 都会有一个电平跳变：

0 → 由 高电平到低电平

1 → 由 低电平到高电平
（有的标准反过来，但核心思想是“每比特必有一次跳变”）。

## 以太网的 MAC 地址

MAC 地址长六字节，由 12 个十六进制数表示。

高 24 位为厂商代码，低 24 位为厂商自行分配的适配器序列号。

## ARP 缓存表

Address Resolution Protocol。

### 工作原理

广播请求：

主机 A 知道目标 IP，但不知道目标 MAC。

A 会在局域网里广播一个 ARP Request：

“谁的 IP 地址是 192.168.1.5？请告诉我你的 MAC 地址。”

单播应答：

拥有该 IP 的主机 B 收到请求后，回复一个 ARP Reply：

“192.168.1.5 的 MAC 是 00-1A-2B-3C-4D-5E。”

缓存结果：

主机 A 把这个映射关系保存到本机的 ARP 缓存表（ARP Table），下次就不用再广播了，直接用。

??? question "广播式网络"

    广播式网络共享广播信道
    
    作为局域网的通信方式，工作在数据链路层，因此可以不要网络层，从而不存在路由选择问题

    数据链路层使用物理层的服务，则需要服务接入点；向高层提高服务，也必须通过服务接入点

### TTL

time to live。就是说过期的时间，毕竟缓存有时候不太可信，时间长了要重新确认。

## 双工

半双工 (Half-duplex)：像对讲机，一方说话时另一方只能听，不能同时说话。

全双工 (Full-duplex)：像电话，双方可以同时说话和听。

## CSMA/CD vs. CSMA/CA

| 特性   | CSMA/CD（以太网）    | CSMA/CA（Wi-Fi） |
| ---- | --------------- | -------------- |
| 检测   | 允许碰撞，事后检测       | 避免碰撞，事前预防      |
| 技术条件 | 有线、可边发边听        | 无线、不能边发边听      |
| 方式   | 碰撞后 Jam 信号 + 退避 | 随机退避 + RTS/CTS |
| 使用   | 早期半双工以太网        | 无线局域网 (802.11) |

公共前缀是 Carrier Sense Multiple Access with Collision 

不同之处，一个 Detection，另一个 Avoidance。

???+ info
    实际上题目问用不用 CSMA/CD，一般就等价于是不是用的半双工




## 传输介质

在以太网的发展中，不同阶段用过不同的传输介质：

10BASE-5：粗同轴电缆

10BASE-2：细同轴电缆

10BASE-T：双绞线（Twisted Pair）

100BASE-TX / 1000BASE-T / 10GBASE-T：双绞线（Cat5e/Cat6 等）

10BASE-F / 100BASE-FX / 1000BASE-LX：光纤

总结来说：T 系列是双绞线 twisted，F 是光纤 fibre，

??? question "用集线器链接的共享式以太网"
    
    实际上以太网也有分类。涉及 CSMA/CD 的，严谨地话就得交代是用集线器（Hub）或者半双工的以太网。

    Hub 是一种 物理层设备（工作在 OSI 模型第 1 层）。它收到某台主机发来的信号时，会把这个信号 原封不动地广播到所有端口。也就是说，所有连在 Hub 上的主机都能“听到”这个信号。
    
    因为所有设备共用一条总线（逻辑上），只有一台主机可以在某个时刻发数据。共享带宽，冲突域大，只能半双工。

    对应地，对比现代以太网（交换机）：
    
    交换机 (Switch) 是数据链路层设备（第 2 层），会根据 MAC 地址 转发数据。

    每个端口是独立的冲突域，支持 全双工通信。不再需要 CSMA/CD，效率比集线器高得多。

??? question "UTP5 类线是双绞线吗"
    
    是的 ✅

    UTP 五类线（Unshielded Twisted Pair Category 5，简称 Cat 5）就是一种 双绞线。

    UTP：表示“无屏蔽双绞线”（Unshielded Twisted Pair）。

    五类线 (Cat 5)：是按电气性能分的等级，主要用于 以太网（10/100 Mbps 传输）。

    物理上，它由 4 对双绞的铜线组成。

光纤以太网主要用于支持点对点通信，目的是扩大以太网的覆盖范围。

IEEE 802.3 标准规定，若采用同轴电缆作为传输介质，在无中继的情况下，传输介质最大长度不能超过 500m。

## 交换的基本方式

| 交换方式     | 特点                    | 以太网对应情况    |
| -------- | --------------------- | ---------- |
| **电路交换** | 通信前先建立一条专用通路，通信期间独占资源 | ❌ 不符合      |
| **报文交换** | 报文整体作为单位存储转发，延迟大      | ❌ 不符合      |
| **分组交换** | 报文先拆分成分组（或帧），逐个存储转发   | ✅ 以太网属于这一类 |
| **混合交换** | 电路 + 分组结合，多用于电话网/移动网  | ❌ 不符合      |

以太网的交换技术属于 分组交换（Packet Switching），更具体来说是 基于帧的分组交换：

数据单位：以太网传输的数据单位是 帧 (Frame)，其实就是一种“分组”。

转发方式：交换机根据 MAC 地址表转发帧，属于典型的分组交换。

非电路交换：以太网不会像电话网那样先建立固定的端到端电路。

非报文交换：报文交换是整份报文一次性转发，而以太网分割成帧逐帧转发。

## 高速以太网

首先吉比特就是 Gbit 的音译。指每秒的传输速率。

100Base 指每秒 100Mbit。

这里应试的规律有点乱。

有一道题说的是：只有 10吉比特以太网 是只能全双工。

另一道题说：光纤不能选用 CSMA/CD 协议，即光纤不能半双工。

那吉比特以太网呢？

如果上面两道题全都正确的话，也就是说吉比特以太网的半双工是用的双绞线实现的半双工。这个真的正确吗？

??? warning "王道考研的书上说吉比特以太网支持半双工"

    1000BASE-X（光纤千兆，以 IEEE 802.3z 定义）

    最初标准里确实规定了半双工和全双工两种模式。

    但实际产品基本上 都只实现全双工，因为千兆环境默认是交换式网络，不再有共享总线。

    1000BASE-T（双绞线千兆，以 IEEE 802.3ab 定义）

    标准 只支持全双工。

    半双工模式在物理上实现难度极高（要同时处理四对双绞线上的回声和串扰），所以规范中就没有给它留半双工选项。

    从标准的角度：IEEE 在最初的 1000BASE-X 里确实保留了半双工条目，所以教材里会提到“吉比特以太网支持半双工”。

    从工程实现的角度：无论是千兆光纤还是千兆铜缆，实际商用设备 几乎都不支持半双工，所以你在现实里只会遇到全双工。

感觉很看出题人心情。总的倾向是，速度越快越不能半双工；光纤比较快。

高速以太网使用的 MAC 帧格式与标准以太网的帧格式完全相同。

## 802.1Q 帧

???+ question

    一个长度为 40 字节的 IP 数据报需要封装成 802.1Q 帧进行传输，则此 802.1Q 帧的数据载荷部分需要填充的字节数是

??? tip "参考解答"

    IEEE 要求的 最小以太网帧长 = 64 字节，这是从目的 MAC（Destination MAC）开始到 FCS（含）结束的字节数。

    带 802.1Q VLAN tag 的帧字段及长度：

    目的 MAC：6 B

    源 MAC：6 B

    VLAN Tag（802.1Q）：4 B

    类型/长度（EtherType）：2 B

    数据载荷（payload）：x B（最小值待求）

    FCS：4 B

    把它们相加并满足最小帧长：

    6 + 6 + 4 + 2 + x + 4 ≥ 64


    所以

    x ≥ 64 − 22 = 42 字节


    → 对于 802.1Q，数据字段（payload）至少为 42 B。

    题中：IP 数据报 长度 = 40 B，放在 payload 中。

    因此需要填充：

    42 − 40 = 2 字节

