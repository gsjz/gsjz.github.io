# 虚拟机网络代理

今天有一个神奇的需求，就是我的主力 win 机上有一个 VMware Workstation 里的 linux 虚拟机。

用 pip 安装东西的时候发现没有直接代理过来，于是想到除了在虚拟机里装 clash 之外应该还能走别的路子。

todo: ai generated, need refactor

## wget

一个通过网络下载东西的指令

```bash
wget linkname
```


## 特性

Windows 的全局代理不会自动传递给 Linux 虚拟机

Linux VM 有独立网络栈，需要单独配置代理

CLI（curl / apt / pip）与浏览器/系统代理是两套机制

## VMware 网络角色

VMnet	类型	用途
VMnet1	Host-only	仅主机 ↔ VM，不连外网
VMnet8	NAT	VM 经主机上网（必须用它）

Windows 在 VMnet8 上的 IP（示例）：

192.168.40.1

???+ info
    这一步需要用
    ```powershell
        ipconfig 
    ```
    来查出

## Windows 侧准备

打开代理软件（Clash / v2rayN 等）

开启「允许局域网连接（Allow LAN）」

记住代理端口（常见）：

HTTP：7890

SOCKS5：7891

## Linux VM：CLI 代理配置

正确的环境变量（注意协议）

```bash
export http_proxy=http://192.168.40.1:7890
export https_proxy=http://192.168.40.1:7890
```


???+ warning "来找茬"
    
    ❌ 错误示例（会导致 TLS EOF）：

    ```bash
    https_proxy=https://192.168.40.1:7890
    ```



测试
```bash
curl https://www.google.com
```

## 为什么 curl 能通，浏览器不通

curl / apt / pip：走 shell 环境变量代理

浏览器：不读取 shell 变量

浏览器必须配置：

自身代理

或 Linux 系统代理

## Linux 系统代理（Ubuntu / GNOME）

路径：

Settings → Network → Proxy → Manual

填写：

HTTP Proxy：192.168.40.1 7890

HTTPS Proxy：192.168.40.1 7890

作用：

浏览器

GUI 程序

⚠️ 不保证影响 apt / pip

## 推荐的最终组合（工程实践）

系统代理 + CLI 环境变量代理

结果：

场景	状态
浏览器	✅
curl / wget	✅
apt / pip	✅
git	✅

## 常见错误速查

问题	原因
TLS unexpected EOF	把 HTTP 代理写成 HTTPS
浏览器打不开	只配了 CLI 代理
VM 不能上网	用了 VMnet1
连不上代理	Windows 没开 Allow LAN

## 一句话总结

VMware 下，Linux VM 想用 Windows 代理：
用 VMnet8 + Windows IP + 正确的代理协议，
CLI 和浏览器要分别配置。


## CLI 代理（curl / apt / pip / git）

设置（临时）

```bash
export http_proxy=http://192.168.40.1:7890
export https_proxy=http://192.168.40.1:7890
```

永久
nano ~/.bashrc

加入
export http_proxy=http://192.168.40.1:7890
export https_proxy=http://192.168.40.1:7890

还原（取消）
unset http_proxy
unset https_proxy


或从 ~/.bashrc 删除后 source ~/.bashrc

## 系统代理（浏览器 / GUI）
设置（Ubuntu / GNOME）
Settings → Network → Proxy → Manual
HTTP/HTTPS: 192.168.40.1:7890

还原
Settings → Network → Proxy → Disabled

## pip 换源
永久（最方便）
pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple

还原
pip config unset global.index-url

## pip 代理（可与换源并存）
设置
pip config set global.proxy http://192.168.40.1:7890

还原
pip config unset global.proxy

## apt 代理
设置
sudo nano /etc/apt/apt.conf.d/99proxy
写入
Acquire::http::Proxy "http://192.168.40.1:7890";
Acquire::https::Proxy "http://192.168.40.1:7890";

还原
sudo rm /etc/apt/apt.conf.d/99proxy

## git 代理
设置
git config --global http.proxy http://192.168.40.1:7890
git config --global https.proxy http://192.168.40.1:7890

还原
git config --global --unset http.proxy
git config --global --unset https.proxy

## 快速自检
env | grep -i proxy
pip config list
git config --global --get http.proxy

## 一句话总原则

Linux 下代理是“分层配置”的：

系统代理 ≠ CLI 代理

工具各管各的

设置和还原都要“对号入座”